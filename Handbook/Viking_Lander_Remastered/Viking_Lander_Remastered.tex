% This is part of the Avaneya Project Crew Handbook.
% Copyright (C) 2010-2013 Cartesian Theatre <info@cartesiantheatre.com>.
% See the file Copying for details on copying conditions.

% Note: This chapter needs to be able to be extracted from the handbook 
%       standalone. Maybe we can use it as the VLR DVD's jewel case insert.

% Viking Lander Remastered chapter...
\StartChapter{Viking Lander Remastered}

% The Martian Landscape
\StartSection{The Martian Landscape}

\placefigure
    [right, 0*hang]
    [figure:Viking_Lander_12E018]
    {A dust storm captured by Viking Lander I in the early morning on {\it Chryse Planitia}. The grid on the panel is used to track the movement of Martian dust.}
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_12E018.png][][width=.4\textwidth]}
Getting the Avaneya game experience right has always been important to us. That means we need to replicate the visual environmental conditions of the Martian landscape as closely as possible. We can do much better than simply making it red, and users appreciate this because it makes their experience feel more genuine.

Since artists, shader engineers, and others, are more interested in what things look like to do their jobs than, say, knowing the peroxide concentration in Martian regolith, it is more important that they have access to photographs depicting what Martian rocks, a sunrise, and the Winter season would look like as if standing there. Large sets of high resolution reference material available for their examination is essential. But Mars, like Earth, is a very large place of greatly varied terrain and climate, so we must be more specific.

Arda and his settlers erected their first settlement in the {\it Arcadia Planitia} region. It is named after the Arcadia region of Ancient Greece, so in turn named after the Greek legend of Arcas\index{Arcas}. This location was selected because there is plenty of water ice, a stable climate, and year round sunlight.

The centre of {\it Arcadia Planitia} is mostly uniform in appearance. The centre is roughly at \math{46.7^{\circ}}N \math{192.0^{\circ}}E. This is mid--latitude in the Northern hemisphere. 

Images of a fresh meteorite crater 12 metres across taken in 2008 revealed a massive blanket of water ice under the surface.\footnotecite[water_ice_on_mars] Luckily, it also turns out that this ice is almost completely pure, with only about one percent of it being non--water.

Even though there is a great deal of water and dry ice on Mars, it is unstable in the thin Martian atmosphere. You rarely ever see it anywhere other than in the polar regions. This is because the ice rapidly sublimates\footnote{When a solid material sublimates, it means it skips melting to a liquid and turns directly into vapour.} as soon as it is exposed.

The region has also experienced recent lava flows. By recent in a geological time scale, we mean within the last few hundred--million years. This suggests Mars most likely still is volcanically active and probably still has a molten core. It does not, however, appear to spin around its core which is why there are only small localized magnetic fields -- but not at a global level. We know this because of {\it Mariner 4's} flyby. This is why a magnetic compass would be useless on Mars.

\placefigure
    [here,force]
    [figure:Viking_Lander_21A028]
    {{\it Utopia Planitia's} rocky surface captured by Viking Lander II.}
    \startcombination[2*1]
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_21A028.png][][width=.4\textwidth]} 
    {}
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_21C174.png][][width=.4\textwidth]}
    {}
    \stopcombination

{\it Arcadia Planitia's} windswept landscape consists of a vast, mostly flat, pale tan coloured plain. It has sand dunes of modest height, never approaching anything higher than a few feet, with small uniformly sized rocks littering the surface. As the prevailing theory goes, these rocks are remnants of some of the underlying bedrock which is an older layer of solidified lava. Every time an asteroid impacts penetrating the younger upper layer, the underlying bedrock ejecta becomes scattered everywhere.

Like all other explored regions, it undergoes constant sterilization through intense ultraviolet radiation. This means that there is probably no {\it known} life on the {\it surface} of Mars.

\page
\StartSection{Viking Mission}

In 1976 NASA successfully placed two spacecraft into Martian orbit after many years of failed American and Russian attempts. These initial failures became unofficially known as the {\it Mars Curse} owing to their high number.\footnotecite[mars_failures] The \index{Viking orbiters}Viking orbiters both carried their own landers which they successfully landed without incident.

The landers were capable of capturing high resolution photographs and other data from the surface of the planet, buffering temporarily onto internal magnetic tapes, and then relaying this data back to Earth through one the orbiters when it was in position, or sometimes directly through a UHF uplink when possible. They provided us with large amounts of data without any issues for four years before finally succumbing to a battery failure on one and a software update bug which shutdown the communication antenna on the other.

At present, no lander has explored Arda's area of settlement, {\it Arcadia Planitia}. This would have been a problem for us, except that the neighbouring plains of {\it Utopia Planitia} are very similar in appearance and we have a multitude of images captured by Viking Lander II. It started doing this on 3 September 1976 from the location of \math{47.7^{\circ}}N \math{225.9^{\circ}}W.

\placefigure
    [here, force]
    [figure:Viking_Lander_0902]
    {{\it Chryse Planitia} as captured by Viking Lander I, later salvaged from a rotting magnetic tape.}
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_0902.png][][width=.9\textwidth]}

\page
\StartSection{Problem: Rotting Tapes, Dead Technology}

While researching the aesthetics of the Martian surface, we found it incredulous that in all the decades passed since the Viking landers sent their images back to Earth, there did not appear to be so much as a single, complete, user friendly, archive of all the images captured. So you can forget downloading a convenient archive of PNGs from NASA's website intended for a layman.\footnotecite[grayzeck2008]

We do, however, have access to the original source data\footnotecite[viking_mission_source_data] from the Viking mission that NASA made available to the public. Some of it is official \index{PDS, Planetary Data Systems}NASA Planetary Data Systems (PDS) archival data and some of it is from the Science Digital Data Preservation Task (SDDPT) of the Jet Propulsion Laboratory which preceded it. The PDS is a branch of NASA entrusted with mission data archival. It was established because of concerns that data from previous missions, such as the Viking mission, were in danger of being lost or rendered unreadable because of failures in preserving the necessary documentation.
\placefigure
    [right, 2*hang]
    [figure:MagneticTape]
    {A 9--track 6250 BPI magnetic tape, like those used with the Viking mission.}
    {\externalfigure[Viking_Lander_Remastered/Images/MagneticTape.png][][width=.4\textwidth]}

The SDDPT archive was prepared by recovering what data NASA could by copying directly off of old, decaying magnetic tapes onto more stable optical media in the 1990s when CDs first became available. That data was \quote{working data,} akin to notes scattered in an office. The images it contains may or may not be useful, but they were expensive to acquire and may contain images not found in the official PDS archive, and vice versa. They did not otherwise alter them. They represent \index{EDR}EDR (Experimental Data Record) level data, which is a processing level at NASA to denote the raw working data that was returned to Earth as captured by each Viking landers' onboard instrumentation.

Although both sources' raw data are now available to everyone as public domain, the entire latter SDDPT archive was encoded in an archaic format that is not very useful to contemporary users, but appropriate during the Viking mission between 20 July 1976 to 5 November 1982. As you might expect, according to NASA few remain today still with them to explain its specification.

The {\it Avaneya: Viking Lander Remastered DVD} was an effort to remedy this problem constructively. It doubles in giving our artists and shader engineers what they need, and also provides the general public with an invaluable educational resource. The software we authored successfully recovers our remastered archive as well organized lossless PNG images. We chose the latter format because everyone already has software that can access PNGs.

We used three source data sets as the basis for our new archive as shown in \in{figure}[figure:Viking_Lander_Remastered_Layout].
\crlf

\placefigure
    [here, force]
    [figure:Viking_Lander_Remastered_Layout]
    {A diagram of the {\it Avaneya: Viking Lander Remastered DVD} image processing pipeline.}
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_Remastered_Layout.svg][][width=.8\textwidth]}

The PDS EDR archive was the first. The format they are encoded in was straightforward to transcode since it is well documented and standardized. The data was cleaned up and re--organized for easier access. For example, if you wanted to know what {\it Utopia Planitia} looks like in the middle of the Winter, all of the images are organized by Martian month. See \in{section}[Calendar] for more information on the Martian calendar.

The SDDPT's {\it Viking Lander High Resolution Mosaics, Stereo Images and Range Data Sets} volumes marked {\tt VL_0001} and {\tt VL_0002} contained raw data recovered from several thousand magnetic tapes in various stages of decay. This was the second archive used. It was the result of NASA stitching together multiple images to form mosaics. Some of them may be rather Frankensteinian in appearance, but understand that they were intended for use in a hectic operational environment at the time. Fortunately we did not have to do any significant work on this set. We simply made the logical directory layout, file names, and documentation more intuitive to the layman. We also got rid of many things that most people either would have found confusing, or probably would not have had much use for.

The SDDPT's {\it Viking Lander Processed Images} was the third source. These were taken from the volumes marked {\tt VL_2101} through {\tt VL_2124}. This dataset amounted to roughly 14--gigabytes of raw mission data. The photographs in this set, after restoration, can be looked at individually as opposed to parts of mosaics. 

The SDDPT is the bulk of the archive's disk size and required a great deal of digital forensic archaeology\index{digital forensic archaeology} to recover. But why? This was because NASA was not concerned at the time of the mission with a long term data archival strategy\index{data archival strategy}. This may be hard to believe for some, but even NASA makes mistakes.\footnotecite[nasa_audit_missing_samples] Keep in mind that this was a very difficult mission to a planet with a long and distinguished history of catastrophic mission failures, finally succeeding at last with a flow of the first real images ever returned from the surface of the Red Planet.

\placefigure
    [left, 0*hang]
    [figure:Viking_Lander_22H093]
    {Viking Lander II captures a beautiful early morning sunrise, {\it Utopia Planitia}.}
    {\externalfigure[Viking_Lander_Remastered/Images/Viking_Lander_22H093.png][][width=0.3\textwidth]}

With no long term data archival strategy in place, eventually the archaic mission data magnetic tapes began to rot. Magnetic tapes can experience \quote{bit rot}\index{bit rot} as the bits of information they contain lose their magnetic orientation. When stored where it is warm and humid, the tapes can quite literally rot. This went on for years before someone noticed. As surprising as this may be to some, it is actually still a major problem at NASA.\footnotecite[the_economist_bitrot2012]

Even if the data had been safe on magnetic tapes, the VICAR\index{VICAR} (Video Image Communication and Retrieval)\index{Video Image Communication and Retrieval} format they were encoded in is an ancient format with origins nearly half a century ago. Moreover, the few remaining functional VICAR image loaders the team managed to access are for much newer file format versions than those used during the Viking era.\footnote{{\tt Xloadimage 4.1} and {\tt ImageMagick 6.7.0} are some examples that can decode newer VICAR data, but not from the Viking mission era.}

This VICAR image processing software specification used at the time unfortunately underwent many revisions over the decades with little, if any, formal documentation of the format used during the Viking mission. The most recent documentation available is from 1994, and even that is still decades too recent to be useful.\footnotecite[vicar_shitty_user_guide]

NASA informed us that they are in possession of the only known allegedly working image loader. However, we were not permitted access to {\it even just the binary} to test. The distribution is severely restricted. NASA's Jet Propulsion Laboratory informed us on 2 June 2011 that they could \quote{\it only provide a royalty--free license to universities (signed by a department head) or a government subcontractor, where the requested software is required to support the effort. At the end of the contract, it must be deleted. [They] cannot provide software to individuals or for research and development purposes.}

Even if we had been granted access or purchased some kind of commercial license, there is still no guarantee that their software would have worked with Viking era data, and even if it could, probably not with the flexibility and automation that we required for a massive 14--gigabyte data set. In all likelihood, after having examined the data in detail, and following many repeated inquiries, with confidence we began to doubt NASA having working software. There was good reason to suspect that {\it no one}, not even NASA, had any usable software to recover the data. They had advised us in good faith as they had, probably because no one had bothered to check in decades.

\StartSection{Solution: Viking Lander Remastered DVD}

In keeping with the spirit of software {\it libre}, we did not wait on proprietary software vendors to hold data access hostage. We authored {\tt viking-extractor}. The latter underlying software supplies the actual recovery power of the {\it Avaneya: Viking Lander Remastered DVD} -- a layman's point--and--click graphical user interface for the former. This was done through a combination of a great deal of reverse engineering of surviving mission data and helpful wisdom from various scientists at NASA, especially one particular individual at the Geosciences Node of NASA's Planetary Data System who wished to remain anonymous.
\placefigure
    [left, 0*hang, none]
    [figure:VLR_Boxes]
    {}
    {\externalfigure[Viking_Lander_Remastered/Images/Boxes.png][][width=0.55\textwidth]}

But why bother? Mainly because we needed the images, in addition to believing that no one should have to perform digital archaeology to see what Mars looks like when photos were already taken, paid for with a billion dollars of public money, and stored for decades -- albeit up in the attic, within a chest, covered in cobwebs, and guarded with a rusted out proprietary lock nobody seems to have a key for at best, selectively rents or refuses to share at worst.

\StartSection{Viking Lander Hardware}

Both Viking landers were equipped with multipurpose photosensor arrays (PSA). These early digital cameras contained an array of twelve photosensor diodes. They were intended for capturing different portions of the electromagnetic spectrum for different purposes. \in{Table}[table:Viking lander PSA] lists all of them.

A great deal of the original mission data was corrupt (e.g. tape rot) or suffered from formatting inconsistencies. This made it difficult to author a reliable forensic recovery tool. The general rule of thumb when deciphering the SDDPT's data set was that there probably wasn't one. You have a very large heterogeneous mixture of files encoded in {\it ad hoc} formats, each containing pieces of information, and invented on the fly for a stressed operational environment that was very much living in the moment. 

However, with the aid of some heuristics and image analysis, the software is reasonably robust and can tolerate a fair amount of noise. It recovers what it can and picks itself up and carries on where it cannot.

\placetable[here][table:Viking lander PSA]{Viking lander photosensor types.}
{
    \bTABLE[split=repeat,option=stretch]
    \setupTABLE[column][5]
        [width=.43\textwidth,
        align=yes]
    \setupTABLE[row][each][align=center]
    \setupTABLE[4][1][align=center]

\bTABLEhead
    \bTR[bottomframe=on]
      \bTH  Band Type \eTH
      \bTH  Qty \eTH
      \bTH  Spectrum \eTH
      \bTH  Resolution \eTH
      \bTH  Description \eTH
    \eTR
\eTABLEhead

\bTABLEbody
    \bTR
      \bTC Broad band \eTC
      \bTC 4 \eTC
      \bTC Broad \eTC
      \bTC High \eTC
      \bTC Used for different focal distances. \eTC
    \eTR

    \bTR
      \bTC Colour \eTC
      \bTC 3 \eTC
      \bTC Narrow \eTC
      \bTC Low \eTC
      \bTC One each for red, green, and blue. \eTC
    \eTR

    \bTR
      \bTC Infrared \eTC
      \bTC 3 \eTC
      \bTC Narrow \eTC
      \bTC Low \eTC
      \bTC Infrared colour imaging.\footnote{The infrared filters degraded with time from the neutron radiation from the lander's plutonium--238 radioisotope thermoelectric generator.} \eTC
    \eTR

    \bTR
      \bTC Survey \eTC
      \bTC 1 \eTC
      \bTC Broad \eTC
      \bTC Low \eTC
      \bTC Monochrome for panoramic images. \eTC
    \eTR
    
    \bTR
      \bTC Sun \eTC
      \bTC 1 \eTC
      \bTC Narrow \eTC
      \bTC Low \eTC
      \bTC For looking at the sun through a red filter. \eTC
    \eTR

\eTABLEbody

\eTABLE
}

The tool recovers whatever it can while transcoding from the VICAR formatted data into lossless PNGs. Here is an example of its use, but keep in mind that you should use the {\tt --help} switch or consult with the manual for more information on the software's usage.

The following sample usage of {\it viking-extractor} catalogues over ten thousand files, organizes them, locates all scattered pieces of the same image, performs optical character recognition, orients them right side up as necessary, compares duplicates for quality, builds a matching set, and reassembles whatever it can. It identifies potentially recoverable images based on, among many other things, their photosensor diode band type. For example {\tt RED/T} meant that the band data that followed in the file was possibly the red component of a disassembled colour triplet set.

\startCodeExample
$ viking-extractor              \
    --directorize-band-class    \
    --directorize-month         \
    --directorize-location      \
    --ignore-bad-files          \
    --interlace                 \
    --recursive                 \
    --generate-metadata         \
    --summarize-only            \
     "Input Directory"          \
     "Output Directory"

\stopCodeExample

Using a quad core 2 GHz amd64 hardware, this fully automated process took about forty minutes. On a low power mips64el machine it took about six hours. The results are presented below.

\startCodeExample
$ find "Output Directory/"
...
Output Directory/Chryse Planitia
Output Directory/Chryse Planitia/Leo/Colour/11J070.png
Output Directory/Chryse Planitia/Leo/Survey/11J071.png
Output Directory/Chryse Planitia/Capricorn/Colour/12C200.txt
...
Output Directory/Utopia Planitia/Aquarius/Colour/22D220.png
...
Output Directory/Utopia Planitia/Scorpius/Colour/22H220.png
...
\stopCodeExample

Some of the metadata needed to make unattended decisions are located within EBCDIC encoded file headers. Extended Binary Coded Decimal Interchange Code (EBCDIC) was an ASCII alternative 8--bit character encoding scheme used mostly on IBM mainframe computers back in the 1950s and 1960s. These headers are made up of \quote{label records} which are meaningful only in the context of these old mainframe machines equipped with magnetic tape drives. Some of the metadata the on--board instrumentation provided can be preserved for the curious. 

As an example, there was a flag indicating whether the camera lens was cleared of dust with compressed gas prior to shooting. It is only available in the PDS data set, but other metadata, such as camera azimuth and elevation almost always are. In any case, this metadata is usually not very useful for most, but the {\tt viking-extractor} can preserve whatever it can if the user wishes.

When relying on the image archive, make sure you are looking at the right place. So if you want to know what {\it Arcadia Planitia} looks like, look at its very similar neighbour that was explored by Viking Lander II, {\it Utopia Planitia}. The other lander touched down on the other side of the planet on {\it Chryse Planitia} (\quote{Plains of Gold}). They may look very similar at first to the untrained eye, but they have many subtle differences.

If you would like to explore the {\tt viking-extractor} source code, see {\tt Avaneya/Extras/VLR/Extractor/} in the project's source tree. If you would like to do this, follow the instructions in \in{section}[Using Bzr].

\placefigure
    [here, force]
    [figure:VikingExtractor_Source]
    {Writing the software to recover images from the Viking landers.}
    {\externalfigure[Viking_Lander_Remastered/Images/VikingExtractor_Source.png][][width=.8\textwidth]}

\StartSection{Epilogue}

The Committee on Data for Science and Technology (CODATA)\index{Committee on Data for Science and Technology (CODATA)} at the Data at Risk Task Group (DARTG)\index{Data at Risk Task Group (DARTG)}, supported in part by the University of North Carolina, is an organization that manages the {\it Data--at--Risk Inventory}. The DARI is a project to produce a catalogue of valuable scientific data at risk of being lost.\footnotecite[murillo2012] This includes deteriorating formats such as magnetic tapes.\footnotecite[dari_about] Because we had always hoped that our software might be useful to others outside of our project, we were pleased to see in 2012 our technology admitted into the DARI inventory.\footnotecite[dari_vlr]

Eventually when our technology was up and running, we took up correspondence again with NASA to share what we had authored. In reflecting on the predicament we had faced respecting the previous inaccessibility of the archive to the general public, a section manager wishing to remain anonymous with the Jet Propulsion Laboratory shared the following reflection. \quote{\it You're right that the Viking Lander archive has been largely inaccessible to the general public. Fortunately, we were successful in salvaging the data thru the migration from magnetic tape to CD so that someone, someday could write software to read and use the data. It sounds like you've done that -- I do indeed understand how difficult a job that was}. This was followed with the publishing of the source code on the Jet Propulsion Laboratory's website.\footnotecite[jpl2013_viking_extractor]

As a final reflection, some readers may be interested to know that some of the SDDPT data was not necessarily corrupt, but unavailable in other ways to our team. We identified at least six magnetic tapes in particular. Four of these tapes were missing altogether. These included tapes {\tt VL-0002}, {\tt VL-0003}, {\tt VL-0027}, and {\tt VL-0325}. In addition, two more tapes were available, but the images themselves were missing. This included tapes {\tt VL-2176} and {\tt VL-2177}. We are in the process of carrying out a Freedom of Information request to obtain additional information.

\placefigure
    [here, force]
    [figure:Not_Received_on_Earth]
    {Image stubs in one of the many missing images.}
    {\externalfigure[Viking_Lander_Remastered/Images/Not_Received_on_Earth.png][][width=.5\textwidth]}

\StopChapter

