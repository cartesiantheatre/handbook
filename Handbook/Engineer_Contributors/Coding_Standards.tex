% This is part of the Avaneya Project Crew Handbook.
% Copyright (C) 2010-2013 Cartesian Theatre <info@cartesiantheatre.com>.
% See the file Copying for details on copying conditions.

% Coding standards section...
\StartSection{Coding Standards}

Try to abide by the project's coding standards whenever possible. It is easier to adapt to a new coding standard in a project when that standard is uniformly applied to it than where everyone applies their own. Any program's source code is both easier on the eyes and to work with when it appears as though only one person wrote it, no matter how many actual contributors there may have been. 

Use the following conventions whenever working in C++, as well as whatever is practical to carry over to shaders, scripts, and elsewhere. These are guidelines and not written in stone, so use common sense and break them when you have to.

\StartSubSection{Declarations and Definitions}

\startitemize[4]
\item
All classes should be defined in their own header file. The only exception is for small trivial classes which are meaningful only in the context of a parent class through aggregation or composition design patterns.

\item
Class method declarations in the class header should be listed in alphabetical order relative to its siblings of the same access rights. That is, sort {\tt protected}, {\tt public}, and {\tt private} methods within themselves, but not globally. In the case of constructors and deconstructors, place these at the beginning and ends respectively.

\item
Class method definitions should be provided in the implementation file ({\tt *.cpp}) listed in alphabetical order, with exceptions made for constructors and deconstructors. These should be defined first and last respectively.

\item
Whenever you want a C++ class's declaration to contain some inline code, leave the class's declaration as usual in its own header, {\tt SomeClass.h}, but move the actual inline definitions into a separate header, {\tt SomeClass.inl}. You can then include the latter into the former after its declaration with the use of an {\tt \#include <SomeClass.inl>}. This way you get the benefits of inline methods where you need them for whatever reason, but without confusing clients of the class in having them do something unusual. They only have to {\tt \#include <SomeClass.h>} as they normally would with any other class. This can also make finding errors at compile time easier with some compilers.
\stopitemize

\StartSubSection{Legal}
Headers (*.h), implementations (*.cpp), and other code, as defined in \in{chapter}[Licensing Rationale], should have prefixed the following legal notice for engine related code. Adapt the syntax for comments as necessary for the given machine environment (e.g. shader, makefile, etc.).

\startCodeExample
/*
    AresEngine, a 3D game engine.
    Copyright (C) 2010-2013 Cartesian Theatre <info@cartesiantheatre.com>.

    Public discussion on IRC available at #avaneya (irc.freenode.net)
    or on the mailing list <avaneya@lists.avaneya.com>.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
\stopCodeExample

Change the description line from referencing the engine to Avaneya, if it is a script or other media that drives the engine, as opposed to the engine itself. This would look as such.

\startCodeExample
/*
    Avaneya, a cerebral science fiction game for GNU.
    Copyright (C) 2010-2013 <kip@thevertigo.com>.

    Public discussion on IRC available at #avaneya (irc.freenode.net)
    ...
\stopCodeExample

Same goes if it is for the Solnet server. If that is the case, use the equivalent licensing text. For more information on Avaneya's licensing rationales, see \in{chapter}[Licensing Rationale].

\StartSubSection{Mathematical}

\startitemize[4]
\item
All angles should be worked with in degrees, not radians, whenever possible.

\item
All floating point calculations should be done in single precision whenever possible. They are usually faster, can take up less space, and we generally do not need the extra precision in a game.
\stopitemize

\StartSubSection{Formatting}

\startitemize[4]
\item
English (Canadian) should be used for everything non--localized and saved in UTF--8 whenever possible.

\item
Always use spaces and not tabs. You can use the latter, if you like, but just as long as your editor converts them to spaces before saving.

\item
Each level of nesting should be indented by four spaces. The exception to this is when a prefix operator precedes an identifier, in which case it should be indented such that the identifier begins at a four space interval.

Right:
\startCodeExample
float SomeFunction()
{
    int i = 0;
  ++i;
    return 1.0f;
}
\stopCodeExample

Wrong:
\startCodeExample
float SomeFunction()
{
    int i = 0;
    ++i;
    return 1.0f;
}
\stopCodeExample

\item
You do not need to indent to accommodate a namespace when an entire source file is enclosed within one. If only part of the source is enclosed in a namespace, then those parts affected should be indented.

\item
An opening brace appears on the next line as preceding code.

Right:
\startCodeExample
float SomeFunction()
{
    for(int x = 0; x < 100; ++x)
    {
        ...
    }
}
\stopCodeExample

Wrong:
\startCodeExample
float SomeFunction() {
    for(int x = 0; x < 100; ++x) {
        ...
    }
}
\stopCodeExample

\item
Put spaces around binary operands.

Right:
\startCodeExample
A = X + Y;
if(X == Y)
    ...
\stopCodeExample

Wrong:
\startCodeExample
A = X+Y;
if(X==Y)
    ...
\stopCodeExample

\item
There is no space between unary operators and the affected variable's identifier.

\item
When accessing an array, there is no space between the array name and the opening left bracket. 

Right:
\startCodeExample
int n[100];
y = n[3];
\stopCodeExample

Wrong:
\startCodeExample
int n [100];
y = n [3];
\stopCodeExample

\item
The {\tt if}, {\tt for}, and {\tt while} keywords are not followed by a space separating them and the left parenthesis. 

Right:
\startCodeExample
if(x == 4)
    return;
\stopCodeExample

Wrong:
\startCodeExample
if (x == 4)
    return;
\stopCodeExample

\item
When declaring variables, align the variable names on the same column evenly divisible by four.

Right:
\startCodeExample
int     Count;
bool    Complete;
Thing   MainThing;
\stopCodeExample

Wrong:
\startCodeExample
int Count;
bool Complete;
Thing MainThing;
\stopCodeExample

\item
When calling a function, definitions and function declarations should have no space between the function name and the following left parenthesis.

Right:
\startCodeExample
int Add(int a, int b)
{ 
    ... 
}

int i = Add(4, 5);
\stopCodeExample

Wrong:
\startCodeExample
int Add (int a, int b)
{
    ...
}

int i = Add (4, 5);
\stopCodeExample

\item
When calling a function or making a function declaration, no space appears after the left parenthesis or before the right parenthesis.

Right:
\startCodeExample
foo(x, y);
bar(z);
baz();
\stopCodeExample

Wrong:
\startCodeExample
foo( x, y );
bar( z );
baz( );
\stopCodeExample

\item
A brace preceding an {\tt else} keyword appears on a separate line as the {\tt else}. A statement following an {\tt else} keyword appears on the following line. 

Right:
\startCodeExample
if(x == 4)
{
    ...
}
else
  ++y;

if(x == 4)
{
    ...
}
else
{
    ...
}
\stopCodeExample

Wrong:
\startCodeExample
if(x == 4) {
    ...
}
else ++y;

if(x == 4) {
    ...
} else ++y;

if(x == 4) {
    ...
}
else {
    ...
}
\stopCodeExample

\item
A brace preceding a {\tt catch} keyword appears on a separate line as the {\tt catch}. 

Right:
\startCodeExample
try
{
    ...
}

catch(Error SomeError)
{
    ...
}
\stopCodeExample

\item
A value in a return statement is parenthesized where it contains more than one term.

Right:
\startCodeExample
{
    return x;
}
...
{
    return (a + b);
}
\stopCodeExample

Wrong:
\startCodeExample
{
    return (x);
}
...
{
    return a + b;
}
\stopCodeExample

\item
If the body of an {\tt if}, {\tt for}, {\tt while} or similar statement consists of a single statement, the statement does not need to be surrounded by braces.

Right:
\startCodeExample
if(x == 3)
  ++x;
\stopCodeExample

\stopitemize

\StartSubSection{Naming}

\startitemize[4]
\item
Do not use Hungarian notation\index{Hungarian notation}. We prefix objects to denote scope only. This is a member of the global namespace:
\startCodeExample
g_Wheels
\stopCodeExample

Member of a structure or class:
\startCodeExample
m_Wheels
\stopCodeExample

Static member of a structure or class:
\startCodeExample
ms_Wheels
\stopCodeExample

\item
Class and object names should be intuitive, try to avoid abbreviations, and each word should begin with a capital letter. Modern storage mediums alleviate us of any need for brevity, allowing for greater clarity.


Right:
\startCodeExample
// Class for abstracting a camera interface...
class Camera
{
    ...
};

// Create a camera...
Camera LogitechCamera;
\stopCodeExample

Wrong:
\startCodeExample
class cam
{
    ...
};

cam log;
\stopCodeExample

\stopitemize

\StartSubSection{Structure}

\startitemize[4]
\item
Source lines may be up to 100 characters long. You may be able to configure your editor to display a margin at this location.

\item
Functions or methods should be broken down into other functions or methods if they get too long and this is reasonable to do.

\item
Use {\tt assert()} to check your assumptions for things that ought to always be true. Do not abuse it for situations where it is reasonable for a condition to not be true, such as a socket connection failure or a file that could not be opened.

\item
Follow the {\it GNU Coding Standards} as much as reasonably possible, save the code formatting points made in this handbook. There is a great deal of wisdom in it.

\item
A comment which indicates task which needs to be done at some point should look like this: 

\startCodeExample
// TODO: Check portability here...
\stopCodeExample

\stopitemize

\StartSubSection{Comments}

\startitemize[4]
\item
All comments should be written in Canadian English since nearly all programmers in all countries can read that. If you cannot do that, write them as best you can and have someone help you rewrite them.

\item
Comments should begin with a single space, then a capital letter and end with a trailing ellipses. 

Right:
\startCodeExample
// Load the image...
GrayImage = cvLoadImage(Path.mb_str(), CV_LOAD_IMAGE_GRAYSCALE);
\stopCodeExample

Wrong:
\startCodeExample
GrayImage = cvLoadImage(Path.mb_str(), CV_LOAD_IMAGE_GRAYSCALE);//load the image.
\stopCodeExample

\item
The farther left the comment, the higher the level of abstraction describing what it is that you are trying to accomplish. The farther right, the more detailed your approach becomes. You can think of a given level of indentation as elaborating on how to carry out what was described at a higher (less indented) level. It should be possible in many cases to strip away all the code, except the comments, and still understand what it is that you were trying to do.

Before:
\startCodeExample
// Analyze single image...
void AnalysisThread::AnalyzeImage(wxString Path)
{
    // Variables...
    IplImage   *GrayImage   = NULL;
    wxString    TempString;

    // Reset the tracker, if not already...
    Frame.Tracker.Reset(0);

    // Load the image...
    GrayImage = cvLoadImage(Path.mb_str(), CV_LOAD_IMAGE_GRAYSCALE);

        // Failed to load media...
        if(!GrayImage)
        {
            // Alert...
            wxLogError(wxT("Unable to load image."));
            
            // Abort...
            return;
        }

    // Feed into tracker...
    Frame.Tracker.Advance(pGrayImage);
    
    // Cleanup gray image...
    cvReleaseImage(&GrayImage);
}
\stopCodeExample

Stripped:
\startCodeExample
// Analyze single image...

    // Variables...

    // Reset the tracker, if not already...

    // Load the image...

        // Failed to load media...

            // Alert...

            // Abort...

    // Feed into tracker...
    
    // Cleanup gray image...
\stopCodeExample

\item
A single blank line should appear between each pair of functions or methods. 

\item
Do not use a blank line after an opening brace or before a closing brace.

\item
Do not use duplicate blank lines.
\stopitemize

\StartSubSection{Integrated Development Environment (IDE)}

You are welcome to use any plain text editor or IDE you like, provided it does not require non--standard IDE--specific project files to pollute the repository's source tree. So feel free to use CodeBlocks or whatever you are most comfortable with, just do not commit its project files to the repository or alter the build environment such that everyone requires to use the same. See \in{section}[Developer Tools] for a list of all other developer tools required for this project.

