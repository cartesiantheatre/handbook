% This is part of the Avaneya Project Crew Handbook.
% Copyright (C) 2010-2017 Cartesian Theatreâ„¢ <info@cartesiantheatre.com>.
% See the file Copying for details on copying conditions.

% Sources, Mutators, Resources, & Sinks section...
\StartSection{Sources, Mutators, Resources, & Sinks}
This section illustrates how resources can be transformed through the game's underlying abstract resource processing pipeline model. A very simple relationship between a {\it source}, its {\it resources}, {\it mutators}, and {\it sinks} is shown in \in{figure}[figure:Resource_Legend].

\placefigure
    [force,here]
    [figure:Resource_Legend]
    {A simple resource processing pipeline.}
    {\externalfigure[Game_Mechanics/Graphviz/Legend.pdf][][width=1.0\textwidth]}

A {\it source} could be any logical group of resources, such as the atmosphere, the ground, imports from another city, or even off world. It acts as the initial supplier of one or more types of resources that feed a resource processing pipeline. Except in the case of imports, a source's resources are usually in some unrefined state. We denote sources on our diagrams as tables, with the resources they are capable of supplying listed within them.

A {\it resource} is anything that can be used to provide or produce some other resource. It is usually, though not necessarily, useful to someone living on Mars. It could be a kind of energy, such as thermal, chemical potential, electrical, or what have you. On the other hand, it could be organic waste. Resources are denoted on our diagrams as octagons.

A {\it mutator} is an abstract entity that transforms a resource into some other. They are denoted on our diagrams as three dimensional boxes. Mutators are physical buildings, such as a plastic factory, but do not have to be. Note how the mutator in \in{figure}[figure:Resource_Legend] combines several resources to produce a new one.

A {\it sink} is the terminal end of a resource's journey through the pipeline, though it may make another one. We denote them on our diagrams as inverted triangles. Sinks are defined in the game as abstract objects with a set of behaviours to carry out on an input resource having met certain condition. They usually map to some physical entity in the world. 

Sources and sinks may be related. Depending on the resource and sink, any number of things could happen when the former enters the latter. As an example, consider Earth's atmosphere as a sink. The sink is capable of absorbing certain resources, such as anthropogenic \chemical{CO_2} to a certain extent. But one of the many adverse side effects is that this will trigger an increase in carbonic acid (\chemical{H_2CO_3}) uptake in the oceans. The oceans are a source because they furnish many resources that are critical to supporting life on Earth. But more carbonic acid in the oceans will reduce their ability to support life.\footnote{Neoclassical economists refer euphemistically to this phenomenon as an {\it externality}\index{externality}.} 

As another example, consider the Martian atmosphere as a source. We can do this because it contains resources which are useful to us on Mars, such as \chemical{CO_2}. This atmospheric \chemical{CO_2} can be fed into the RWGS reactor described in \in{section}[Reverse-Water-Gas-Shift Reactor] to produce new resources. These resources are carbon monoxide (\chemical{CO}) and molecular hydrogen and oxygen. The carbon monoxide could in turn undergo further refinement when combined with other resources and mutators to produce yet additional resources like methanol, plastics, or what have you. In that case, the hydrogen was cycled back into the reactor as a reagent and the oxygen used for life support. This latter oxygen then passes through human respiration, a resource mutator, producing in turn food resources (ATP) and \chemical{CO_2} from the \chemical{O_2}. The \chemical{CO_2} could be vented back out into the atmospheric sink.

Whenever a resource enters a sink and efficiently replenishes all of a source's resources that went into its creation, we call this recycling. Whenever this is not the case and a resource is non--renewable, we know that the source's supply of the resource will eventually become depleted. This is one of the many reasons why the models adopted by neoclassical economists are wrong, because they presuppose the indefinite viability of linear transformation pipelines while drawing on finite resources.

With these basic building blocks, it is possible to have resource processing pipelines as complex or over simplified as a designer likes. Since all of Avaneya's sources, resources, mutators, and sinks are data driven, to add more one simply defines new ones through the Lua interface (see \in{section}[Scripting]). Although there is no theoretical limit to its complexity, the diversity of resources, and the things one can do with them, it is convenient to examine some of a \quote{core set}.

An over simplified model is illustrated in \in{figure}[figure:Resources_Pipeline]. Note that not all resources require processing to be useful. For instance, although the Martian atmosphere is mostly \chemical{CO_2}, that gas is already a resource in and of itself because it has many applications -- even though it could still undergo further refinement.

\FullPageDiagram
    {figure:Resources_Pipeline}
    {The resource pipeline of all the core sources, resources, mutators, and sinks.}
    {Game_Mechanics/Graphviz/Resources.pdf}

For the purpose of clarity, we added the same resource sometimes twice, once in its source, and once again as a separate node on the diagram. The reason for this is because sometimes there may be more than one way of getting a resource, such as through an off--world import or out of the ground.

If you look carefully at \in{figure}[figure:Resources_Pipeline], you will notice that there are no sinks. We avoided putting these on the diagram because it would make it harder to read in linking every resource to all possible sinks to cover every conceivable situation. Instead, let us consider \in{figure}[figure:Resource_Sinks] to illustrate some of the possibilities with a reduced resource set.

\placefigure
    [force,here]
    [figure:Resource_Sinks]
    {Resources and sinks.}
    {\externalfigure[Game_Mechanics/Graphviz/Sinks.pdf][][width=1.0\textwidth]}

Here again the ground is a source of resources, including an artesian aquifer. When tapped with a geothermal station, it will provide aqua or liquid water, electricity, and heat. The electricity and heat can be used for any number of things, but we must be careful with what we do with the water. If the underground well is not replenished, it will eventually become depleted. If this happens, the dangerous likelihood of the surface collapsing into a sinkhole increases.

\StartSubSection{Resource and Mutator Lifecycle}
As mentioned above, resources can be used in their raw form or changed through mutators (single or multiple) to form a variety of commodities, waste, and new resources. Depending on inputs and processes, these will have certain effects. Some will be instant while others will take various amounts of time for the effect to become obvious. Many of the resources in any of their initial, mutated, or sink states can be produced, stored, used, exported, imported, and moved.

Storage of resources can exist at a variety of locations. Initially this may be on a geological, biological, or similar level in a \quote{natural} state. Storage can also take place after initial mining or harvesting at this location, or it may need permanent or specialized forms of storage -- e.g. cryogenic liquid oxygen. Resources then go through a lifecycle of consumption depending on many factors. They may sit on construction sites, supermarket shelves, vent into the atmosphere, or end up at a farmers' market at your city's bazaar.

%How resources are transported is also dependent on the level of infrastructure. Some resources such as apples or grains may be easy to distribute locally in small quantities. Others such as metals, gasses, and large volumes of material require better infrastructure or technology. These may be transported in a variety of manners from on foot to interstellar transport depending on cities agents, technological growth, and other influences. In terms of gameplay, the best outcome is for resources in the natural, transport, and storage states to be displayed visually for the user.

%Resources will take various forms and shapes as they are gathered, used, stored, or wasted. , and may go from being simply terrain to a product, an environmental problem, or even a solution. In this progression and use the game will need to keep track or transforming objects into the various forms, the object's location, and the effects it will have. For instance, a mineral mined outside of a city's limits could start as a slight shimmer on a rocky martian landscape. This will then change as a project is set up extracting it from the surface. The minerals new form will depend on how it was extracted, but it changes from being {\it X} amount of {\it Y} to {\it G} amount of {\it H}. It is still the mineral {\it Y}, but in a derived state {\it H}. However it could also be in other states, say chemical extraction {\it I}. When in these next states, {\it H} or {\it I}, it is at the location of the mining in one of possibly many \quote{secondary states}, it could be loose on the ground due to lack of storage or disaster, in the back of a truck, in a storage facility, or any number of places. The material is then transferred from this state into another state when it reaches another facility or is processed further; in fact it can change any number of times, even being recycled until it is ultimately wasted or expended, or returned to the earth (returning to a sink in all cases), depending on the resource and player choices. 

%From this it can be seen that giving resources a large number of options for mutation into other materials requires extensive tracking and detail, but can be data driven.

\StartSubSection{Implementation}

The aforementioned provided a number of very simple examples of the interaction of sources, mutators, resources, and sinks. The challenge will be to implement appropriate algorithms that can handle a much more complex interaction of all of these in an efficient manner. The GPU will undoubtedly play a role in solving this problem.

At some point we will probably have to build a custom tool with an accessible graphical user interface for designers to prepare such data. A user interface similar to Blender's compositor with nodes and edges joining those nodes would be a good start. The tool could check the design for errors before attempting to \quote{compile} or \quote{bake} the data into some kind of optimized intermediate format for the player's GPU at runtime. It could also maintain a database of all available sources, mutators, resources, and sinks to assist designers.

