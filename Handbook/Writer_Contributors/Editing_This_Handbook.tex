% This is part of the Avaneya Project Crew Handbook.
% Copyright (C) 2010, 2011, 2012 Cartesian Theatre <kip@thevertigo.com>.
% See the file Copying for details on copying conditions.

% Editing This Handbook section
\StartSection{Editing This Handbook}

This section is of interest to people only if they would like to work on this book. If that was your intention, then hopefully you managed to successfully obtain a copy of the project's source using the method described in \in{section}[Using Bzr]. You will need to have done this because the book's source is contained within it.

Some things to make a mental note of before we get started. This document was compiled on \currentdate\ from Bzr revision \BzrRevisionClickable. It was typeset using the \CONTEXT\ document engineering system, \contextmark\ \contextversion. The rendering backend used by \contextmark\ was \texenginename\ \texengineversion. 

This information is useful in the event you observe unexpected differences between a copy you built yourself and someone else's. Different versions of the software used may have been a factor. We worked very closely with the \CONTEXT\ developers while writing this book and identified many bugs that they managed to patch. The problem is that the patched versions may still be too bleeding edge and therefore lag behind what is available through your distribution's package manager.

To get you started as quickly as possible in building this document from source, you will need a number of tools installed, including a working \CONTEXT\ installation. If you would like to be hard on yourself and build \CONTEXT\ from source, instructions are available on the \CONTEXT\ \href{http://wiki.contextgarden.net/ConTeXt_Minimals}{wiki} for most platforms. 

Otherwise, if you are running some flavour of Ubuntu, you are in luck. \MailTo{adam.reviczky@kcl.ac.uk}{Adam Reviczky} was kind enough to provide us with his Personal Package Archives (PPA) containing the latest precompiled packages for both \CONTEXT\ and \texenginename. Consider yourself warned though, Adam's PPA automatically pulls the latest upstream \CONTEXT\ and \texenginename\ source on a daily basis. This means that either program may work fine one day, only to break on another.

The remaining support packages should already all be available from within Ubuntu's official package servers, such as the programs necessary for generating the various illustrations found within this book.

To prepare your build environment on Ubuntu 12.04 Precise Pangolin, run the following commands while connected to the internet. Note that the \quote{\type{\}} character is just there for readability to denote a line break. You do not need to actually type it. In your terminal, you can collapse lines containing this trailing character into a single command before hitting enter.

\startCodeExample
$ sudo add-apt-repository ppa:reviczky/context-daily
$ sudo add-apt-repository ppa:reviczky/luatex-daily
$ sudo aptitude update
$ sudo aptitude install     \
    context                 \
    context-fonts           \
    context-modules         \
    fonts-larabie-deco      \
    graphviz                \
    inkscape                \
    pdftk                   \
    texlive-math-extra      \
    ttf-ubuntu-font-family  \
    xvfb                    \
    umbrello
\stopCodeExample

Note that if you are not running {\it Ubuntu Raring} or {\it Quantal}, but {\it Precise} or older, you will need to download the \href{http://distribution.contextgarden.net/current/fonts/new/fonts/opentype/public/lm-math/latinmodernmath-regular.otf}{latinmodernmath-regular.otf} font directly into your {\tt \type{~}/.fonts} path because it is not included in the dependencies \ConTeXt\ pulls. It is needed to typeset various mathematical formulae.

This will add Adam's PPA, update your package list, download, install, and automatically configure the necessary programs needed to edit and build this book. This may take a while, depending on the speed of your internet connection and computer, but thankfully you only need to do this once. Feel free to go and pour yourself a chilled mug of kombucha while you wait.

Be warned that the version of Graphviz included in Ubuntu's repositories may not be new enough. You want to make sure you are pulling at least version 2.29. If you are not (check {\tt dot -V}), you can get the latest packages from their \href{http://www.graphviz.org/Download_linux_ubuntu.php}{website}. If you use an older Graphviz, some of the diagrams will come out wrong. If you are not working on them and just editing other parts of the book, this probably will not matter anyways.

Please also note that the latest versions of \CONTEXT\ require \TEXLIVE\ 2012, which is unavailable in Ubuntu repositories or other PPAs prior to version 12.04.

If either your \CONTEXT\ or \texenginename\ packages are ever upgraded, which is probably inevitable, Adam wisely recommended to us that you do several things. This is to avoid any issues that might arise from residual artifacts generated by either of the aforementioned still residing within caches that became obsolete during the upgrade process.

\startCodeExample
$ cd ~/
$ rm -Rfv ~/.texmf-var
$ luatools --generate
$ mtxrun --generate
$ context --make
$ context --make cont-en cont-nl
$ mtxrun --script fonts --reload
\stopCodeExample

Now that you have everything installed, simply change your working directory to the handbook's source root directory and run the following to build it.

\startCodeExample
$ cd Avaneya/Documentation/Contributors/Handbook
$ make
\stopCodeExample

If everything went well, you should have the handbook PDF sitting within the aforementioned working directory. Note that this process of building the handbook may take a few minutes depending on your computer. If at any time you would like to clean out most of the temporary files the build process left behind, including the resulting PDF, just run the following.

\startCodeExample
$ make clean
\stopCodeExample

If you would like to do the aforementioned and clear out all images that were cached to speed up the build process as well, just substitute the {\tt clean} target for {\tt clean-all} instead.

Now that you are able to build the handbook, you can edit the source and see the result of your work easily by simply running {\tt make}. To commit your changes back upstream to our official master branch, follow the instructions as illustrated in \in{section}[Committing Changes].

